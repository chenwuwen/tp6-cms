<div class="layui-fluid">

    <form class="layui-form" action="" lay-filter="component-form-group">


        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">客户名称</label>
                <div class="layui-input-inline">
                    <input type="text" value='{$customer.customer_name}' name="customer_name" lay-verify="required"
                        autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">地址</label>
                <div class="layui-input-inline">
                    <input type="text" value='{$customer.customer_address}' name="customer_address" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">电话</label>
                <div class="layui-input-inline">
                    <input type="tel" name="phone" value='{$customer.phone}' lay-verify="phone" autocomplete="off"
                        class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">联系人</label>
                <div class="layui-input-inline">
                    <input name="contacts" value='{$customer.contacts}' class="layui-input">
                </div>
            </div>
        </div>

        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">收货单位</label>
                <div class="layui-input-inline">
                    <input type="text" value='{$customer.recipient_company}' name="recipient_company"
                        lay-verify="required" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">收货地址</label>
                <div class="layui-input-inline">
                    <input type="text" value='{$customer.recipient_address}' name="recipient_address"
                        class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">收货电话</label>
                <div class="layui-input-inline">
                    <input type="text" value='{$customer.recipient_phone}' name="recipient_phone" lay-verify="phone"
                        autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">收货人</label>
                <div class="layui-input-inline">
                    <input type="text" value='{$customer.recipient}' name="recipient" autocomplete="off"
                        class="layui-input">
                </div>
            </div>
        </div>


        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">开票资料</label>
                <div class="layui-input-inline">
                    <button type="button" class="layui-btn" id="test1">
                        <i class="layui-icon">&#xe67c;</i>上传附件
                    </button>
                    <i id="file_name">{$customer.ticket_data}</i>
                    <input type="text" value='{$customer.ticket_data}' id="ticket_data" name="ticket_data"
                        style="display: none">
                </div>
            </div>
        </div>

        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">收票地址</label>
                <div class="layui-input-inline">
                    <input type="text" value='{$customer.ticket_address}' name="ticket_address" class="layui-input">
                </div>
            </div>
        </div>

        <div class="layui-form-item">

            <div class="layui-inline">
                <label class="layui-form-label">收票电话</label>
                <div class="layui-input-inline">
                    <input type="tel" value='{$customer.ticket_phone}' name="ticket_phone" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">收票人</label>
                <div class="layui-input-inline">
                    <input type="text" value='{$customer.ticket}' name="ticket" class="layui-input">
                </div>
            </div>
        </div>


        <div class="layui-form-item">
            <div class="layui-input-block">
                <div class="layui-footer">
                    <button class="layui-btn" lay-submit="" lay-filter="component-form-customer">立即提交</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>
        </div>
    </form>

</div>

<script>


    layui.use(['jquery', 'form', 'element', 'upload', 'table'], function () {

        var table = layui.table;
        var form = layui.form;
        var upload = layui.upload;
        var $ = layui.$;

        form.on('submit(component-form-customer)', function (data) {
            console.log(data.elem) //被执行事件的元素DOM对象，一般为button对象
            console.log(data.form) //被执行提交的form对象，一般在存在form标签时才会返回
            console.log(data.field) //当前容器的全部表单字段，名值对形式：{name: value}
            $.ajax({
                url: '{:url("/admin/customer/addOrEditCustomer")}',
                type: 'post',
                data: data.field,
                success: function (result) {
                    if (result.code == 0) {
                        layer.msg('成功!', {
                            icon: 6,
                            time: 1000,
                            shade: 0.3,
                            end: function () {
                                // layer自关闭
                                //当你在iframe页面关闭自身时
                                var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
                                parent.layer.close(index); //再执行关闭 
                            }
                        });
                    } else {
                        layer.msg(result.msg);
                    }

                },
                error: function () {
                    layer.msg('系统错误');
                }
            });
            return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
        });

        var uploadInst = upload.render({
            elem: '#test1',  //绑定元素
            url: '{:url("/upload")}',  //上传接口
            auto: true, //自动上传
            accept: '*',
            multiple: false, //是否允许多文件上传
            choose: function (obj) {
                var files = obj.pushFile();
                console.log(files)
                obj.preview(function (index, file, result) {
                    $("#file_name").html(file.name)
                })
            },
            done: function (res) {
                //上传完毕回调
                console.log(res)
                $("#ticket_data").val(res.data)
            },
            error: function () {
                //请求异常回调
                layer.alert('上传附件失败!')
            }
        });
    })
</script>